## 关于项目的一些思考
Q. 究竟啥是负载均衡啊？
- 对于目前的应用而言,几乎离不开集群部署,不论是采用单体架构多副本部署还是微服务架构,不论是为了实现高可用还是高性能,都需要利用多台机器来扩展服务能力

- 比如对于用户的请求不管连接到哪台机器上,都能得到相同的处理

- 如何构建和调度服务集群这件事情,必须对用户保持足够的透明,即使请求背后是由非常多台机器共同响应,也并不是用户关心的事,用户只需要记住一个域名地址而已

- 调用后方的多台机器,以统一的接口对外提供服务,承担此职能的技术组件被称为**负载均衡**

- 一般来说负载均衡背后对应一个服务器农场,由这个负载均衡器来选择一个服务器的ip和port返回给客户端,避免了客户端直接和服务器进行交互,从而对服务器进行一个攻击(高频访问),保障了服务器的安全

- 同时负载均衡也可以降低客户端的一个等待时间,比如有多个客户端,这多个客户端可以通过负载均衡器快速得到可用的节点,如果这多个客户同时访问一个节点那么就会导致这个节点过载,影响客户端的体验

- 负载均衡器通过负载均衡调度算法,在内网服务器中选择一个服务器返回给客户端,这里就需要判断服务器的一个状态,防止其过载或失效导致应用程序的可靠性降低

- 项目中的负载均衡调度算法,是对每一个服务器农场中的服务器封装一个host_info类,里面保存了调用的一些属性,比如虚成功/失败,真实成功/失败,连续成功/失败的次数,同时维护一个时间戳,表示我们只关心一段时间服务器的状态

- 当客户端向负载均衡器发送请求时,由其向两个队列中通过相应的算法选择一个服务器的ip和port返回给客户端,同时对相应的host_info中的属性进行一个修改,修改完毕之后,根据配置文件中的比率来判断当前服务器是否过载,从而再对两个队列进行操作

Q. 啥是四层/七层负载均衡啊？
- OSI的下三层是媒体层,上四层是主机层
- 到了主机层也就谈不上什么流量转发,最多只能做代理
- 这里四层/七层对应的是OSI七层模型中的第四层(传输层)和第七层(应用层)
- 四层负载均衡中的四层表示这些工作模式的共同特点是维持着同一个TCP连接,这些模式主要都是工作在二层(数据链路层),第三层(网络层)上,单纯只处理第四层的数据无法做到负载均衡转发
- 数据链路层负载均衡:修改目的MAC地址,从负载均衡MAC-->真实服务器MAC,那么在IP层对应的客户端IP和负载均衡器IP没有变,所以需要把真实物理服务器集群所有机器的虚拟IP地址(VIP)配置成和负载均衡器的虚拟IP一样,避免负载均衡器网卡带宽成为瓶颈
- 四层负载均衡器都无法胜任需要感知应用层协议的场景
- NAT模式也是一种负载均衡模式
- 四层负载均衡工作模式都属于"转发"
- 七层负载均衡工作模式,工作在四层之后的负载均衡模式无法再进行转发,只能代理
- 七层负载均衡器属于反向代理,设置在服务器上,对客户端来说是透明的
- 七层负载均衡器比四层多一轮TCP握手,有带宽问题
- 由于七层均衡器工作在应用层,可以感知应用层通信的具体内容,通常可以做出更明智的决策

Q. 负载均衡器分为静态和动态,是啥意思啊？

- 本项目是动态负载均衡调度,表示会考虑系统中每台服务器的一个运行状态,当然项目中判断状态的方法较为简单,只是根据相应的比率来判断是否过载

- 而静态负载均衡表示不会关注每台服务器的运行状态,其根据预先确定的计划去分配任务,这样有可能导致个别服务器严重过载,因为这个服务器的处理能力相对来说比较落后

- 动态负载均衡的算法一般都有最少连接,加权最少连接,基于资源和地理位置等相关算法,本项目中并没有统计服务器对应的客户端的链接数量,只是通过是否返回成功以及窗口来判断,这样是比较低效的

Q. 都有啥负载均衡策略啊？
- 轮询均衡
- 权重轮循均衡:根据服务器的不同处理能力,给每个服务器分配不同的权值,使其能够接受相应权值数的服务请求
- 随机均衡
- 权重随机均衡(分配请求时是随机选择的)
- 一致性哈希均衡:根据参数作为特征值来计算需要落在的节点
- 响应速度均衡:负载均衡设备对内部服务器发送探测请求(例如ping),根据响应时间(负载均衡到服务器)来决定
- 最少连接均衡:适合长时处理的请求服务,FTP传输

- 软件均衡器:内核的LVS(Linux Virtual Server),应用程序形式(Nginx,HAProxy,KeepAlived),前面的性能好,后面的使用方便,不受限于内核版本

Q. 集成协程有啥用？系统究竟是如何部署的？

- 没啥用,协程的应用场景是高并发IO异步,负载均衡器运行在服务器上(并非客户端,每台服务器都有相应的ip和port),也就意味着IO操作并不多,那么瓶颈就不可能出现在IO上

- 还是有一点点的作用的,只不过非常有限,那就是在后台线程上,后台线程长时间运行,并且在项目中经常是通过睡几秒来判断一次条件,这样其仍然是占据CPU执行的,所以协程的作用目前看来在这能有点用,睡多长时间就可以节省多长CPU时间
